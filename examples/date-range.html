<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>自定义范围：日期</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <div class="region">
    <div class="stage">
      <div class="data-panel">
        <div class="data-filter" id="data_filter">
          <div class="data-filter__group">
            <p><b>选择日期范围:</b></p>
            <div class="data-filter__validator" v-for="v in groups.date_range.all()">
              <input type="radio" v-model="values.date_range" :value="v.id" :id="v.id" @change="handleValidatorChange('date_range')">
              <label :for="v.id">{{ v.label }} ({{ v.total }})</label>
            </div>
          </div>
        </div>
        <div class="data-layout data-layout--table" id="data_layout">
          <div class="table-wrapper">
            <table class="jc-table">
              <thead>
                <tr>
                  <th @click.stop="sortBy('id', $event)">
                    <div class="data-layout__header-content">ID<i class="sorting-indicator"></i></div>
                  </th>
                  <th @click.stop="sortBy('manufacturer', $event)">
                    <div class="data-layout__header-content">Manufacturer<i class="sorting-indicator"></i></div>
                  </th>
                  <th @click.stop="sortBy('manufacture_oe', $event)">
                    <div class="data-layout__header-content">Manufacturer #<i class="sorting-indicator"></i></div>
                  </th>
                  <th @click.stop="sortBy('inborn_filter_oe', $event)">
                    <div class="data-layout__header-content">Inborn Filter #<i class="sorting-indicator"></i></div>
                  </th>
                  <th @click.stop="sortBy('category', $event)">
                    <div class="data-layout__header-content">Category<i class="sorting-indicator"></i></div>
                  </th>
                  <th @click.stop="sortBy('updated_at', $event)">
                    <div class="data-layout__header-content">更新时间<i class="sorting-indicator"></i></div>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="record in currentPageRecords">
                  <td><div class="data-layout__column-content" v-html="render(record, 'id')"></div></td>
                  <td><div class="data-layout__column-content" v-html="render(record, 'manufacturer')"></div></td>
                  <td><div class="data-layout__column-content" v-html="render(record, 'manufacture_oe')"></div></td>
                  <td><div class="data-layout__column-content" v-html="render(record, 'inborn_filter_oe')"></div></td>
                  <td><div class="data-layout__column-content" v-html="render(record, 'category')"></div></td>
                  <td><div class="data-layout__column-content" v-html="render(record, 'updated_at')"></div></td>
                </tr>
              </tbody>
            </table>
          </div>
          <c-pagination
            :total="records.length"
            :per-page="pagination.perPage"
            @page-change="handleCurrentPageChange">
          </c-pagination>
        </div>
      </div>
    </div>
  </div>

  <script src="../js/vendor/moment.min.js"></script>
  <script src="../js/vendor/vue/dist/vue.min.js"></script>
  <script src="../js/c-pagination.js"></script>
  <script src="../js/validators.js"></script>
  <script src="../js/data-panel.js"></script>
  <script src="../js/data.js"></script>
  <script>

    /**
     * 生成数据展示组件
     */
    const layout = DataPanel.newLayout({
      // *必需* 目标元素
      el: '#data_layout',
    });

    function getTime(time) {
      return moment(time).valueOf();
    }

    const now = Date.now();

    // 用来生成验证器组的元数据
    const groups = [
      { // 定义在属性 manufacturer 上的值验证器组
        name: 'date_range',
        type: 'range',
        prop: 'id',
        multiple: false,
        validators: [
          // (new BaseValidator('updated_at', '[any]')).setValidator(function() {return true}),
          (new RangeValidator('updated_at', 0, now, '[any]')).setCaster(getTime),
          (new RangeValidator('updated_at', moment().startOf('day').valueOf(), now, '今天')).setCaster(getTime),
          (new RangeValidator('updated_at', moment().subtract(3, 'days').valueOf(), now, '最近 3 天')).setCaster(getTime),
          (new RangeValidator('updated_at', moment().subtract(7, 'days').valueOf(), now, '最近 7 天')).setCaster(getTime),
        ],
      },
    ];

    /**
     * 生成数据展示组件
     */
    const filter = DataPanel.newFilter({
      // *必需* 目标元素
      el: '#data_filter',

      // *必需* 指定布局组件
      layout: layout,

      // *必需* 用来生成验证器组的元数据
      groups: groups,
    });

    filter.init(records);
  </script>
</body>
</html>
